{% extends "base.html" %}

{% block title %}Order History - Premium Meat Delivery{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Order History</h1>
        <p>Track your past orders</p>
    </div>
</section>

<section class="order-history-section">
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        {% if orders %}
        <div class="orders-list">
            {% for order in orders %}
            <div class="order-card">
                <div class="order-header">
                    <div>
                        <h3>Order #{{ order.id }}</h3>
                        <p class="order-date">{{ order.date }}</p>
                    </div>
                    <div class="order-status status-{{ order.status }}">
                        <i class="fas fa-circle"></i> {{ order.status|capitalize }}
                    </div>
                </div>
                
                <div class="order-items">
                    {% for item in order.order_items %}
                    <div class="order-item">
                        <span class="item-name">{{ item.name }}</span>
                        <span class="item-quantity">x{{ item.quantity }}</span>
                        <span class="item-price">KSH {{ (item.price * item.quantity)|format_currency }}</span>
                    </div>
                    {% endfor %}
                </div>
                
                {% if order.delivery_info %}
                <div class="order-delivery-info">
                    <h4><i class="fas fa-truck"></i> Delivery Information</h4>
                    <p><i class="fas fa-phone"></i> {{ order.delivery_info.phone }}</p>
                    <p><i class="fas fa-map-marker-alt"></i> {{ order.delivery_info.address }}, {{ order.delivery_info.city }} {{ order.delivery_info.postal_code }}</p>
                    {% if order.delivery_info.notes %}
                    <p><i class="fas fa-sticky-note"></i> {{ order.delivery_info.notes }}</p>
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="order-payment-info">
                    <h4><i class="fas fa-credit-card"></i> Payment & Verification</h4>
                    <p><i class="fas fa-money-bill-wave"></i> Payment Method: <strong>{{ order.payment_method|upper }}</strong></p>
                    <p><i class="fas fa-check-circle"></i> Payment Status: 
                        {% if order.payment_status == 'completed' %}
                        <span class="verified-badge"><i class="fas fa-check"></i> Paid</span>
                        {% elif order.payment_status == 'initiated' %}
                        <span class="unverified-badge"><i class="fas fa-clock"></i> Processing</span>
                        {% else %}
                        <span class="unverified-badge"><i class="fas fa-clock"></i> Pending</span>
                        {% endif %}
                    </p>
                    <p><i class="fas fa-key"></i> Secret Code: <strong class="secret-code">{{ order.secret_code }}</strong></p>
                    <p><i class="fas fa-shield-alt"></i> Verification Status: 
                        {% if order.code_verified %}
                        <span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>
                        {% else %}
                        <span class="unverified-badge"><i class="fas fa-clock"></i> Pending Verification</span>
                        {% endif %}
                    </p>
                </div>
                
                <div class="order-footer">
                    <span class="order-total">Total: KSH {{ order.total|format_currency }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-orders">
            <i class="fas fa-box-open"></i>
            <h2>No orders yet</h2>
            <p>Start shopping to create your first order!</p>
            <a href="{{ url_for('products') }}" class="btn btn-primary">Browse Products</a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
